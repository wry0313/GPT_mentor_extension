/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/chatgpt.js":
/*!************************!*\
  !*** ./src/chatgpt.js ***!
  \************************/
/***/ (() => {

throw new Error("Module build failed (from ./node_modules/babel-loader/lib/index.js):\nSyntaxError: /Users/gavinwang/CODE/chatgpt-extension-daily-summery/src/chatgpt.js: Unexpected token, expected \"{\" (21:0)\n\n\u001b[0m \u001b[90m 19 |\u001b[39m )\u001b[0m\n\u001b[0m \u001b[90m 20 |\u001b[39m\u001b[0m\n\u001b[0m\u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 21 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36masync\u001b[39m \u001b[36mfunction\u001b[39m getChatGPTAccessToken() {\u001b[0m\n\u001b[0m \u001b[90m    |\u001b[39m \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\u001b[0m\n\u001b[0m \u001b[90m 22 |\u001b[39m   \u001b[36mif\u001b[39m (cache\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[33mKEY_ACCESS_TOKEN\u001b[39m)) {\u001b[0m\n\u001b[0m \u001b[90m 23 |\u001b[39m     \u001b[36mreturn\u001b[39m cache\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[33mKEY_ACCESS_TOKEN\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\u001b[0m \u001b[90m 24 |\u001b[39m   }\u001b[0m\n    at instantiate (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:63:32)\n    at constructor (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:356:12)\n    at Parser.raise (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:3240:19)\n    at Parser.unexpected (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:3270:16)\n    at Parser.expect (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:3612:28)\n    at Parser.parseBlock (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:13100:10)\n    at Parser.parseFunctionBody (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:11926:24)\n    at Parser.parseFunctionBodyAndFinish (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:11912:10)\n    at /Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:13254:12\n    at Parser.withSmartMixTopicForbiddingContext (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:12236:14)\n    at Parser.parseFunction (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:13253:10)\n    at Parser.parseFunctionStatement (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:12918:17)\n    at Parser.parseStatementContent (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:12680:25)\n    at Parser.parseStatementLike (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:12551:17)\n    at Parser.parseModuleItem (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:12528:17)\n    at Parser.parseBlockOrModuleBlockBody (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:13123:36)\n    at Parser.parseBlockBody (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:13116:10)\n    at Parser.parseProgram (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:12439:10)\n    at Parser.parseTopLevel (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:12429:25)\n    at Parser.parse (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:14247:10)\n    at parse (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/parser/lib/index.js:14288:38)\n    at parser (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/core/lib/parser/index.js:41:34)\n    at parser.next (<anonymous>)\n    at normalizeFile (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/core/lib/transformation/normalize-file.js:64:38)\n    at normalizeFile.next (<anonymous>)\n    at run (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/core/lib/transformation/index.js:21:50)\n    at run.next (<anonymous>)\n    at transform (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/core/lib/transform.js:22:41)\n    at transform.next (<anonymous>)\n    at step (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:261:32)\n    at /Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:273:13\n    at async.call.result.err.err (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:223:11)\n    at /Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:189:28\n    at /Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/@babel/core/lib/gensync-utils/async.js:68:7\n    at /Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:113:33\n    at step (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:287:14)\n    at /Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:273:13\n    at async.call.result.err.err (/Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:223:11)\n    at /Users/gavinwang/CODE/chatgpt-extension-daily-summery/node_modules/gensync/index.js:37:40");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
(() => {
"use strict";
/*!***************************!*\
  !*** ./src/background.js ***!
  \***************************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _chatgpt_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chatgpt.js */ "./src/chatgpt.js");
let lastTitle = null;
let startTime = null;
const timeTracker = new Map();

console.log("hello this is background.js");
async function testCode() {
  try {
    const token = await (0,_chatgpt_js__WEBPACK_IMPORTED_MODULE_0__.getChatGPTAccessToken)();
    const provider = new _chatgpt_js__WEBPACK_IMPORTED_MODULE_0__.ChatGPTProvider(token);
    provider.generateAnswer("just say ok");
  } catch (error) {
    console.log('Error:', error);
  }
}
testCode();
function handleActiveTabChange() {
  // Query the currently active tab
  chrome.tabs.query({
    active: true,
    currentWindow: true
  }, function (tabs) {
    // Access the active tab object
    var activeTab = tabs[0];

    // Extract relevant information
    // var tabUrl = activeTab.url;
    var tabTitle = activeTab.title;
    const currentTime = Date.now();
    if (!lastTitle) {
      // If there was no previous tab title, initialize the start time
      lastTitle = tabTitle;
      startTime = currentTime;
    } else {
      const elapsedTime = (currentTime - startTime) / 1000;
      if (timeTracker.has(lastTitle)) {
        // If the previous tab title is already in the timeTracker map,
        // update the total time by adding the elapsed time
        const totalTime = timeTracker.get(lastTitle) + elapsedTime;
        timeTracker.set(lastTitle, totalTime);
        // console.log(lastTitle, totalTime);
      } else {
        // If the previous tab title is not in the timeTracker map,
        // create a new entry with the elapsed time
        timeTracker.set(lastTitle, elapsedTime);
        // console.log(lastTitle, elapsedTime);
      }
      // Update the lastTitle and startTime for the new tab
      lastTitle = tabTitle;
      startTime = currentTime;
    }
  });
}

// Event listener for tab activation change
chrome.tabs.onActivated.addListener(handleActiveTabChange);

// Event listener for tab title update
chrome.tabs.onUpdated.addListener(function (tabId, changeInfo, tab) {
  if (changeInfo.title) {
    // If the tab title is updated, call the handleActiveTabChange function
    handleActiveTabChange();
  }
});
function extractHostname(url) {
  try {
    const parsedUrl = new URL(url);
    return parsedUrl.hostname;
  } catch (error) {
    console.error('Invalid URL:', error);
    return null;
  }
}
function printMap(map) {
  map.forEach((value, key) => {
    console.log(key + ' => ' + value);
  });
}
function cleanMap(timeTracker, minTime) {
  for (let [key, value] of timeTracker) {
    if (value < minTime) {
      timeTracker.delete(key);
    }
  }
}

// Add event listener to the button

// Add message listener in background.js
chrome.runtime.onMessage.addListener(function (message, sender, sendResponse) {
  if (message.action === 'print') {
    // Call the printMap function here
    printMap(timeTracker); // Replace `timeTracker` with your actual map variable
  }

  if (message.action === 'clean') {
    cleanMap(timeTracker, message.minTime);
  }
});
})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YXAiLCJ3ZWJwYWNrOi8vY2hhdGdwdC1leHRlbnNpb24tZGFpbHktc3VtbWVyeS93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL2NoYXRncHQtZXh0ZW5zaW9uLWRhaWx5LXN1bW1lcnkvLi9zcmMvYmFja2dyb3VuZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwibGV0IGxhc3RUaXRsZSA9IG51bGw7XG5sZXQgc3RhcnRUaW1lID0gbnVsbDtcbmNvbnN0IHRpbWVUcmFja2VyID0gbmV3IE1hcCgpO1xuXG5pbXBvcnQgeyBDaGF0R1BUUHJvdmlkZXIsIGdldENoYXRHUFRBY2Nlc3NUb2tlbiB9IGZyb20gJy4vY2hhdGdwdC5qcyc7XG5cbmNvbnNvbGUubG9nKFwiaGVsbG8gdGhpcyBpcyBiYWNrZ3JvdW5kLmpzXCIpO1xuXG5hc3luYyBmdW5jdGlvbiB0ZXN0Q29kZSgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGdldENoYXRHUFRBY2Nlc3NUb2tlbigpO1xuICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IENoYXRHUFRQcm92aWRlcih0b2tlbik7XG4gICAgcHJvdmlkZXIuZ2VuZXJhdGVBbnN3ZXIoXCJqdXN0IHNheSBva1wiKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUubG9nKCdFcnJvcjonLCBlcnJvcik7XG4gIH1cbn1cbnRlc3RDb2RlKCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUFjdGl2ZVRhYkNoYW5nZSgpIHtcbiAgLy8gUXVlcnkgdGhlIGN1cnJlbnRseSBhY3RpdmUgdGFiXG4gIGNocm9tZS50YWJzLnF1ZXJ5KHsgYWN0aXZlOiB0cnVlLCBjdXJyZW50V2luZG93OiB0cnVlIH0sIGZ1bmN0aW9uKHRhYnMpIHtcbiAgICAvLyBBY2Nlc3MgdGhlIGFjdGl2ZSB0YWIgb2JqZWN0XG4gICAgdmFyIGFjdGl2ZVRhYiA9IHRhYnNbMF07XG5cbiAgICAvLyBFeHRyYWN0IHJlbGV2YW50IGluZm9ybWF0aW9uXG4gICAgLy8gdmFyIHRhYlVybCA9IGFjdGl2ZVRhYi51cmw7XG4gICAgdmFyIHRhYlRpdGxlID0gYWN0aXZlVGFiLnRpdGxlO1xuXG4gICAgY29uc3QgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGlmICghbGFzdFRpdGxlKSB7XG4gICAgICAvLyBJZiB0aGVyZSB3YXMgbm8gcHJldmlvdXMgdGFiIHRpdGxlLCBpbml0aWFsaXplIHRoZSBzdGFydCB0aW1lXG4gICAgICBsYXN0VGl0bGUgPSB0YWJUaXRsZTtcbiAgICAgIHN0YXJ0VGltZSA9IGN1cnJlbnRUaW1lO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBlbGFwc2VkVGltZSA9IChjdXJyZW50VGltZSAtIHN0YXJ0VGltZSkgLyAxMDAwO1xuICAgICAgaWYgKHRpbWVUcmFja2VyLmhhcyhsYXN0VGl0bGUpKSB7XG4gICAgICAgIC8vIElmIHRoZSBwcmV2aW91cyB0YWIgdGl0bGUgaXMgYWxyZWFkeSBpbiB0aGUgdGltZVRyYWNrZXIgbWFwLFxuICAgICAgICAvLyB1cGRhdGUgdGhlIHRvdGFsIHRpbWUgYnkgYWRkaW5nIHRoZSBlbGFwc2VkIHRpbWVcbiAgICAgICAgY29uc3QgdG90YWxUaW1lID0gdGltZVRyYWNrZXIuZ2V0KGxhc3RUaXRsZSkgKyBlbGFwc2VkVGltZTtcbiAgICAgICAgdGltZVRyYWNrZXIuc2V0KGxhc3RUaXRsZSwgdG90YWxUaW1lKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2cobGFzdFRpdGxlLCB0b3RhbFRpbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgdGhlIHByZXZpb3VzIHRhYiB0aXRsZSBpcyBub3QgaW4gdGhlIHRpbWVUcmFja2VyIG1hcCxcbiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IGVudHJ5IHdpdGggdGhlIGVsYXBzZWQgdGltZVxuICAgICAgICB0aW1lVHJhY2tlci5zZXQobGFzdFRpdGxlLCBlbGFwc2VkVGltZSk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGxhc3RUaXRsZSwgZWxhcHNlZFRpbWUpO1xuICAgICAgfVxuICAgICAgLy8gVXBkYXRlIHRoZSBsYXN0VGl0bGUgYW5kIHN0YXJ0VGltZSBmb3IgdGhlIG5ldyB0YWJcbiAgICAgIGxhc3RUaXRsZSA9IHRhYlRpdGxlO1xuICAgICAgc3RhcnRUaW1lID0gY3VycmVudFRpbWU7XG4gICAgfVxuICB9KTtcbn1cblxuLy8gRXZlbnQgbGlzdGVuZXIgZm9yIHRhYiBhY3RpdmF0aW9uIGNoYW5nZVxuY2hyb21lLnRhYnMub25BY3RpdmF0ZWQuYWRkTGlzdGVuZXIoaGFuZGxlQWN0aXZlVGFiQ2hhbmdlKTtcblxuLy8gRXZlbnQgbGlzdGVuZXIgZm9yIHRhYiB0aXRsZSB1cGRhdGVcbmNocm9tZS50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbih0YWJJZCwgY2hhbmdlSW5mbywgdGFiKSB7XG4gIGlmIChjaGFuZ2VJbmZvLnRpdGxlKSB7XG4gICAgLy8gSWYgdGhlIHRhYiB0aXRsZSBpcyB1cGRhdGVkLCBjYWxsIHRoZSBoYW5kbGVBY3RpdmVUYWJDaGFuZ2UgZnVuY3Rpb25cbiAgICBoYW5kbGVBY3RpdmVUYWJDaGFuZ2UoKTtcbiAgfVxufSk7XG5cbmZ1bmN0aW9uIGV4dHJhY3RIb3N0bmFtZSh1cmwpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWRVcmwgPSBuZXcgVVJMKHVybCk7XG4gICAgcmV0dXJuIHBhcnNlZFVybC5ob3N0bmFtZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIFVSTDonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZnVuY3Rpb24gcHJpbnRNYXAobWFwKSB7XG4gIG1hcC5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XG4gICAgY29uc29sZS5sb2coa2V5ICsgJyA9PiAnICsgdmFsdWUpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY2xlYW5NYXAodGltZVRyYWNrZXIsIG1pblRpbWUpIHtcbiAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIHRpbWVUcmFja2VyKSB7XG4gICAgaWYgKHZhbHVlIDwgbWluVGltZSkge1xuICAgICAgdGltZVRyYWNrZXIuZGVsZXRlKGtleSk7XG4gICAgfVxuICB9XG59XG5cbi8vIEFkZCBldmVudCBsaXN0ZW5lciB0byB0aGUgYnV0dG9uXG5cbi8vIEFkZCBtZXNzYWdlIGxpc3RlbmVyIGluIGJhY2tncm91bmQuanNcbmNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbiAobWVzc2FnZSwgc2VuZGVyLCBzZW5kUmVzcG9uc2UpIHtcbiAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAncHJpbnQnKSB7XG4gICAgLy8gQ2FsbCB0aGUgcHJpbnRNYXAgZnVuY3Rpb24gaGVyZVxuICAgIHByaW50TWFwKHRpbWVUcmFja2VyKTsgLy8gUmVwbGFjZSBgdGltZVRyYWNrZXJgIHdpdGggeW91ciBhY3R1YWwgbWFwIHZhcmlhYmxlXG4gIH0gXG4gIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2NsZWFuJykge1xuICAgIGNsZWFuTWFwKHRpbWVUcmFja2VyLCBtZXNzYWdlLm1pblRpbWUpXG4gIH1cbn0pOyJdLCJuYW1lcyI6WyJsYXN0VGl0bGUiLCJzdGFydFRpbWUiLCJ0aW1lVHJhY2tlciIsIk1hcCIsIkNoYXRHUFRQcm92aWRlciIsImdldENoYXRHUFRBY2Nlc3NUb2tlbiIsImNvbnNvbGUiLCJsb2ciLCJ0ZXN0Q29kZSIsInRva2VuIiwicHJvdmlkZXIiLCJnZW5lcmF0ZUFuc3dlciIsImVycm9yIiwiaGFuZGxlQWN0aXZlVGFiQ2hhbmdlIiwiY2hyb21lIiwidGFicyIsInF1ZXJ5IiwiYWN0aXZlIiwiY3VycmVudFdpbmRvdyIsImFjdGl2ZVRhYiIsInRhYlRpdGxlIiwidGl0bGUiLCJjdXJyZW50VGltZSIsIkRhdGUiLCJub3ciLCJlbGFwc2VkVGltZSIsImhhcyIsInRvdGFsVGltZSIsImdldCIsInNldCIsIm9uQWN0aXZhdGVkIiwiYWRkTGlzdGVuZXIiLCJvblVwZGF0ZWQiLCJ0YWJJZCIsImNoYW5nZUluZm8iLCJ0YWIiLCJleHRyYWN0SG9zdG5hbWUiLCJ1cmwiLCJwYXJzZWRVcmwiLCJVUkwiLCJob3N0bmFtZSIsInByaW50TWFwIiwibWFwIiwiZm9yRWFjaCIsInZhbHVlIiwia2V5IiwiY2xlYW5NYXAiLCJtaW5UaW1lIiwiZGVsZXRlIiwicnVudGltZSIsIm9uTWVzc2FnZSIsIm1lc3NhZ2UiLCJzZW5kZXIiLCJzZW5kUmVzcG9uc2UiLCJhY3Rpb24iXSwic291cmNlUm9vdCI6IiJ9